<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - libavcodec/atrac3plusdsp.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">libavcodec</a> - atrac3plusdsp.c<span style="font-size: 80%;"> (source / <a href="atrac3plusdsp.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">158</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2023-11-05 17:27:07</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">7</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<a name="2"><span class="lineNum">       2 </span>            :  * ATRAC3+ compatible decoder</a>
<a name="3"><span class="lineNum">       3 </span>            :  *</a>
<a name="4"><span class="lineNum">       4 </span>            :  * Copyright (c) 2010-2013 Maxim Poliakovski</a>
<a name="5"><span class="lineNum">       5 </span>            :  *</a>
<a name="6"><span class="lineNum">       6 </span>            :  * This file is part of FFmpeg.</a>
<a name="7"><span class="lineNum">       7 </span>            :  *</a>
<a name="8"><span class="lineNum">       8 </span>            :  * FFmpeg is free software; you can redistribute it and/or</a>
<a name="9"><span class="lineNum">       9 </span>            :  * modify it under the terms of the GNU Lesser General Public</a>
<a name="10"><span class="lineNum">      10 </span>            :  * License as published by the Free Software Foundation; either</a>
<a name="11"><span class="lineNum">      11 </span>            :  * version 2.1 of the License, or (at your option) any later version.</a>
<a name="12"><span class="lineNum">      12 </span>            :  *</a>
<a name="13"><span class="lineNum">      13 </span>            :  * FFmpeg is distributed in the hope that it will be useful,</a>
<a name="14"><span class="lineNum">      14 </span>            :  * but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="15"><span class="lineNum">      15 </span>            :  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="16"><span class="lineNum">      16 </span>            :  * Lesser General Public License for more details.</a>
<a name="17"><span class="lineNum">      17 </span>            :  *</a>
<a name="18"><span class="lineNum">      18 </span>            :  * You should have received a copy of the GNU Lesser General Public</a>
<a name="19"><span class="lineNum">      19 </span>            :  * License along with FFmpeg; if not, write to the Free Software</a>
<a name="20"><span class="lineNum">      20 </span>            :  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</a>
<a name="21"><span class="lineNum">      21 </span>            :  */</a>
<a name="22"><span class="lineNum">      22 </span>            : </a>
<a name="23"><span class="lineNum">      23 </span>            : /**</a>
<a name="24"><span class="lineNum">      24 </span>            :  *  @file</a>
<a name="25"><span class="lineNum">      25 </span>            :  *  DSP functions for ATRAC3+ decoder.</a>
<a name="26"><span class="lineNum">      26 </span>            :  */</a>
<a name="27"><span class="lineNum">      27 </span>            : </a>
<a name="28"><span class="lineNum">      28 </span>            : #include &lt;math.h&gt;</a>
<a name="29"><span class="lineNum">      29 </span>            : </a>
<a name="30"><span class="lineNum">      30 </span>            : #include &quot;libavutil/float_dsp.h&quot;</a>
<a name="31"><span class="lineNum">      31 </span>            : #include &quot;libavutil/libm.h&quot;</a>
<a name="32"><span class="lineNum">      32 </span>            : #include &quot;libavutil/mem_internal.h&quot;</a>
<a name="33"><span class="lineNum">      33 </span>            : </a>
<a name="34"><span class="lineNum">      34 </span>            : #include &quot;avcodec.h&quot;</a>
<a name="35"><span class="lineNum">      35 </span>            : #include &quot;sinewin.h&quot;</a>
<a name="36"><span class="lineNum">      36 </span>            : #include &quot;fft.h&quot;</a>
<a name="37"><span class="lineNum">      37 </span>            : #include &quot;atrac3plus.h&quot;</a>
<a name="38"><span class="lineNum">      38 </span>            : </a>
<a name="39"><span class="lineNum">      39 </span>            : /**</a>
<a name="40"><span class="lineNum">      40 </span>            :  *  Map quant unit number to its position in the spectrum.</a>
<a name="41"><span class="lineNum">      41 </span>            :  *  To get the number of spectral lines in each quant unit do the following:</a>
<a name="42"><span class="lineNum">      42 </span>            :  *  num_specs = qu_to_spec_pos[i+1] - qu_to_spec_pos[i]</a>
<a name="43"><span class="lineNum">      43 </span>            :  */</a>
<a name="44"><span class="lineNum">      44 </span>            : const uint16_t ff_atrac3p_qu_to_spec_pos[33] = {</a>
<a name="45"><span class="lineNum">      45 </span>            :       0,    16,   32,   48,   64,   80,   96,  112,</a>
<a name="46"><span class="lineNum">      46 </span>            :     128,   160,  192,  224,  256,  288,  320,  352,</a>
<a name="47"><span class="lineNum">      47 </span>            :     384,   448,  512,  576,  640,  704,  768,  896,</a>
<a name="48"><span class="lineNum">      48 </span>            :     1024, 1152, 1280, 1408, 1536, 1664, 1792, 1920,</a>
<a name="49"><span class="lineNum">      49 </span>            :     2048</a>
<a name="50"><span class="lineNum">      50 </span>            : };</a>
<a name="51"><span class="lineNum">      51 </span>            : </a>
<a name="52"><span class="lineNum">      52 </span>            : /* Scalefactors table. */</a>
<a name="53"><span class="lineNum">      53 </span>            : /* Approx. Equ: pow(2.0, (i - 16.0 + 0.501783948) / 3.0) */</a>
<a name="54"><span class="lineNum">      54 </span>            : const float ff_atrac3p_sf_tab[64] = {</a>
<a name="55"><span class="lineNum">      55 </span>            :     0.027852058,  0.0350914, 0.044212341, 0.055704117,  0.0701828,</a>
<a name="56"><span class="lineNum">      56 </span>            :     0.088424683, 0.11140823,   0.1403656,  0.17684937, 0.22281647, 0.2807312, 0.35369873,</a>
<a name="57"><span class="lineNum">      57 </span>            :     0.44563293,   0.5614624,  0.70739746,  0.89126587,  1.1229248, 1.4147949,  1.7825317,</a>
<a name="58"><span class="lineNum">      58 </span>            :     2.2458496,    2.8295898,   3.5650635,   4.4916992,  5.6591797,  7.130127,  8.9833984,</a>
<a name="59"><span class="lineNum">      59 </span>            :     11.318359,    14.260254,   17.966797,   22.636719,  28.520508, 35.933594,  45.273438,</a>
<a name="60"><span class="lineNum">      60 </span>            :     57.041016,    71.867188,   90.546875,   114.08203,  143.73438, 181.09375,  228.16406,</a>
<a name="61"><span class="lineNum">      61 </span>            :     287.46875,     362.1875,   456.32812,    574.9375,    724.375, 912.65625,   1149.875,</a>
<a name="62"><span class="lineNum">      62 </span>            :     1448.75,      1825.3125,     2299.75,      2897.5,   3650.625,    4599.5,     5795.0,</a>
<a name="63"><span class="lineNum">      63 </span>            :     7301.25,         9199.0,     11590.0,     14602.5,    18398.0,   23180.0,    29205.0,</a>
<a name="64"><span class="lineNum">      64 </span>            :     36796.0,        46360.0,     58410.0</a>
<a name="65"><span class="lineNum">      65 </span>            : };</a>
<a name="66"><span class="lineNum">      66 </span>            : </a>
<a name="67"><span class="lineNum">      67 </span>            : /* Mantissa table. */</a>
<a name="68"><span class="lineNum">      68 </span>            : /* pow(10, x * log10(2) + 0.05) / 2 / ([1,2,3,5,7,15,31] + 0.5) */</a>
<a name="69"><span class="lineNum">      69 </span>            : const float ff_atrac3p_mant_tab[8] = {</a>
<a name="70"><span class="lineNum">      70 </span>            :     0.0,</a>
<a name="71"><span class="lineNum">      71 </span>            :     0.74801636,</a>
<a name="72"><span class="lineNum">      72 </span>            :     0.44882202,</a>
<a name="73"><span class="lineNum">      73 </span>            :     0.32058716,</a>
<a name="74"><span class="lineNum">      74 </span>            :     0.20400238,</a>
<a name="75"><span class="lineNum">      75 </span>            :     0.1496048,</a>
<a name="76"><span class="lineNum">      76 </span>            :     0.07239151,</a>
<a name="77"><span class="lineNum">      77 </span>            :     0.035619736</a>
<a name="78"><span class="lineNum">      78 </span>            : };</a>
<a name="79"><span class="lineNum">      79 </span>            : </a>
<a name="80"><span class="lineNum">      80 </span>            : #define ATRAC3P_MDCT_SIZE (ATRAC3P_SUBBAND_SAMPLES * 2)</a>
<a name="81"><span class="lineNum">      81 </span>            : </a>
<a name="82"><span class="lineNum">      82 </span><span class="lineNoCov">          0 : av_cold void ff_atrac3p_init_imdct(AVCodecContext *avctx, FFTContext *mdct_ctx)</span></a>
<a name="83"><span class="lineNum">      83 </span>            : {</a>
<a name="84"><span class="lineNum">      84 </span>            :     /* Initialize the MDCT transform. */</a>
<a name="85"><span class="lineNum">      85 </span><span class="lineNoCov">          0 :     ff_mdct_init(mdct_ctx, 8, 1, -1.0);</span></a>
<a name="86"><span class="lineNum">      86 </span><span class="lineNoCov">          0 : }</span></a>
<a name="87"><span class="lineNum">      87 </span>            : </a>
<a name="88"><span class="lineNum">      88 </span>            : #define TWOPI (2 * M_PI)</a>
<a name="89"><span class="lineNum">      89 </span>            : </a>
<a name="90"><span class="lineNum">      90 </span>            : #define DEQUANT_PHASE(ph) (((ph) &amp; 0x1F) &lt;&lt; 6)</a>
<a name="91"><span class="lineNum">      91 </span>            : </a>
<a name="92"><span class="lineNum">      92 </span>            : static DECLARE_ALIGNED(32, float, sine_table)[2048]; ///&lt; wave table</a>
<a name="93"><span class="lineNum">      93 </span>            : static DECLARE_ALIGNED(32, float, hann_window)[256]; ///&lt; Hann windowing function</a>
<a name="94"><span class="lineNum">      94 </span>            : static float amp_sf_tab[64];   ///&lt; scalefactors for quantized amplitudes</a>
<a name="95"><span class="lineNum">      95 </span>            : </a>
<a name="96"><span class="lineNum">      96 </span><span class="lineNoCov">          0 : av_cold void ff_atrac3p_init_dsp_static(void)</span></a>
<a name="97"><span class="lineNum">      97 </span>            : {</a>
<a name="98"><span class="lineNum">      98 </span><span class="lineNoCov">          0 :     int i;</span></a>
<a name="99"><span class="lineNum">      99 </span>            : </a>
<a name="100"><span class="lineNum">     100 </span>            :     /* generate sine wave table */</a>
<a name="101"><span class="lineNum">     101 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 2048; i++)</span></a>
<a name="102"><span class="lineNum">     102 </span><span class="lineNoCov">          0 :         sine_table[i] = sin(TWOPI * i / 2048);</span></a>
<a name="103"><span class="lineNum">     103 </span>            : </a>
<a name="104"><span class="lineNum">     104 </span>            :     /* generate Hann window */</a>
<a name="105"><span class="lineNum">     105 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 256; i++)</span></a>
<a name="106"><span class="lineNum">     106 </span><span class="lineNoCov">          0 :         hann_window[i] = (1.0f - cos(TWOPI * i / 256.0f)) * 0.5f;</span></a>
<a name="107"><span class="lineNum">     107 </span>            : </a>
<a name="108"><span class="lineNum">     108 </span>            :     /* generate amplitude scalefactors table */</a>
<a name="109"><span class="lineNum">     109 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 64; i++)</span></a>
<a name="110"><span class="lineNum">     110 </span><span class="lineNoCov">          0 :         amp_sf_tab[i] = exp2f((i - 3) / 4.0f);</span></a>
<a name="111"><span class="lineNum">     111 </span>            : </a>
<a name="112"><span class="lineNum">     112 </span><span class="lineNoCov">          0 :     ff_init_ff_sine_windows(7);</span></a>
<a name="113"><span class="lineNum">     113 </span><span class="lineNoCov">          0 :     ff_init_ff_sine_windows(6);</span></a>
<a name="114"><span class="lineNum">     114 </span><span class="lineNoCov">          0 : }</span></a>
<a name="115"><span class="lineNum">     115 </span>            : </a>
<a name="116"><span class="lineNum">     116 </span>            : /**</a>
<a name="117"><span class="lineNum">     117 </span>            :  *  Synthesize sine waves according to given parameters.</a>
<a name="118"><span class="lineNum">     118 </span>            :  *</a>
<a name="119"><span class="lineNum">     119 </span>            :  *  @param[in]    synth_param   ptr to common synthesis parameters</a>
<a name="120"><span class="lineNum">     120 </span>            :  *  @param[in]    waves_info    parameters for each sine wave</a>
<a name="121"><span class="lineNum">     121 </span>            :  *  @param[in]    envelope      envelope data for all waves in a group</a>
<a name="122"><span class="lineNum">     122 </span>            :  *  @param[in]    fdsp          ptr to floating-point DSP context</a>
<a name="123"><span class="lineNum">     123 </span>            :  *  @param[in]    invert_phase  flag indicating 180Â° phase shift</a>
<a name="124"><span class="lineNum">     124 </span>            :  *  @param[in]    reg_offset    region offset for trimming envelope data</a>
<a name="125"><span class="lineNum">     125 </span>            :  *  @param[out]   out           receives sythesized data</a>
<a name="126"><span class="lineNum">     126 </span>            :  */</a>
<a name="127"><span class="lineNum">     127 </span><span class="lineNoCov">          0 : static void waves_synth(Atrac3pWaveSynthParams *synth_param,</span></a>
<a name="128"><span class="lineNum">     128 </span>            :                         Atrac3pWavesData *waves_info,</a>
<a name="129"><span class="lineNum">     129 </span>            :                         Atrac3pWaveEnvelope *envelope,</a>
<a name="130"><span class="lineNum">     130 </span>            :                         AVFloatDSPContext *fdsp,</a>
<a name="131"><span class="lineNum">     131 </span>            :                         int invert_phase, int reg_offset, float *out)</a>
<a name="132"><span class="lineNum">     132 </span>            : {</a>
<a name="133"><span class="lineNum">     133 </span><span class="lineNoCov">          0 :     int i, wn, inc, pos;</span></a>
<a name="134"><span class="lineNum">     134 </span><span class="lineNoCov">          0 :     double amp;</span></a>
<a name="135"><span class="lineNum">     135 </span><span class="lineNoCov">          0 :     Atrac3pWaveParam *wave_param = &amp;synth_param-&gt;waves[waves_info-&gt;start_index];</span></a>
<a name="136"><span class="lineNum">     136 </span>            : </a>
<a name="137"><span class="lineNum">     137 </span><span class="lineNoCov">          0 :     for (wn = 0; wn &lt; waves_info-&gt;num_wavs; wn++, wave_param++) {</span></a>
<a name="138"><span class="lineNum">     138 </span>            :         /* amplitude dequantization */</a>
<a name="139"><span class="lineNum">     139 </span><span class="lineNoCov">          0 :         amp = amp_sf_tab[wave_param-&gt;amp_sf] *</span></a>
<a name="140"><span class="lineNum">     140 </span><span class="lineNoCov">          0 :               (!synth_param-&gt;amplitude_mode</span></a>
<a name="141"><span class="lineNum">     141 </span><span class="lineNoCov">          0 :                ? (wave_param-&gt;amp_index + 1) / 15.13f</span></a>
<a name="142"><span class="lineNum">     142 </span><span class="lineNoCov">          0 :                : 1.0f);</span></a>
<a name="143"><span class="lineNum">     143 </span>            : </a>
<a name="144"><span class="lineNum">     144 </span><span class="lineNoCov">          0 :         inc = wave_param-&gt;freq_index;</span></a>
<a name="145"><span class="lineNum">     145 </span><span class="lineNoCov">          0 :         pos = DEQUANT_PHASE(wave_param-&gt;phase_index) - (reg_offset ^ 128) * inc &amp; 2047;</span></a>
<a name="146"><span class="lineNum">     146 </span>            : </a>
<a name="147"><span class="lineNum">     147 </span>            :         /* waveform generation */</a>
<a name="148"><span class="lineNum">     148 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; 128; i++) {</span></a>
<a name="149"><span class="lineNum">     149 </span><span class="lineNoCov">          0 :             out[i] += sine_table[pos] * amp;</span></a>
<a name="150"><span class="lineNum">     150 </span><span class="lineNoCov">          0 :             pos     = (pos + inc) &amp; 2047;</span></a>
<a name="151"><span class="lineNum">     151 </span>            :         }</a>
<a name="152"><span class="lineNum">     152 </span>            :     }</a>
<a name="153"><span class="lineNum">     153 </span>            : </a>
<a name="154"><span class="lineNum">     154 </span>            :     /* invert phase if requested */</a>
<a name="155"><span class="lineNum">     155 </span><span class="lineNoCov">          0 :     if (invert_phase)</span></a>
<a name="156"><span class="lineNum">     156 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul_scalar(out, out, -1.0f, 128);</span></a>
<a name="157"><span class="lineNum">     157 </span>            : </a>
<a name="158"><span class="lineNum">     158 </span>            :     /* fade in with steep Hann window if requested */</a>
<a name="159"><span class="lineNum">     159 </span><span class="lineNoCov">          0 :     if (envelope-&gt;has_start_point) {</span></a>
<a name="160"><span class="lineNum">     160 </span><span class="lineNoCov">          0 :         pos = (envelope-&gt;start_pos &lt;&lt; 2) - reg_offset;</span></a>
<a name="161"><span class="lineNum">     161 </span><span class="lineNoCov">          0 :         if (pos &gt; 0 &amp;&amp; pos &lt;= 128) {</span></a>
<a name="162"><span class="lineNum">     162 </span><span class="lineNoCov">          0 :             memset(out, 0, pos * sizeof(*out));</span></a>
<a name="163"><span class="lineNum">     163 </span><span class="lineNoCov">          0 :             if (!envelope-&gt;has_stop_point ||</span></a>
<a name="164"><span class="lineNum">     164 </span><span class="lineNoCov">          0 :                 envelope-&gt;start_pos != envelope-&gt;stop_pos) {</span></a>
<a name="165"><span class="lineNum">     165 </span><span class="lineNoCov">          0 :                 out[pos + 0] *= hann_window[0];</span></a>
<a name="166"><span class="lineNum">     166 </span><span class="lineNoCov">          0 :                 out[pos + 1] *= hann_window[32];</span></a>
<a name="167"><span class="lineNum">     167 </span><span class="lineNoCov">          0 :                 out[pos + 2] *= hann_window[64];</span></a>
<a name="168"><span class="lineNum">     168 </span><span class="lineNoCov">          0 :                 out[pos + 3] *= hann_window[96];</span></a>
<a name="169"><span class="lineNum">     169 </span>            :             }</a>
<a name="170"><span class="lineNum">     170 </span>            :         }</a>
<a name="171"><span class="lineNum">     171 </span>            :     }</a>
<a name="172"><span class="lineNum">     172 </span>            : </a>
<a name="173"><span class="lineNum">     173 </span>            :     /* fade out with steep Hann window if requested */</a>
<a name="174"><span class="lineNum">     174 </span><span class="lineNoCov">          0 :     if (envelope-&gt;has_stop_point) {</span></a>
<a name="175"><span class="lineNum">     175 </span><span class="lineNoCov">          0 :         pos = (envelope-&gt;stop_pos + 1 &lt;&lt; 2) - reg_offset;</span></a>
<a name="176"><span class="lineNum">     176 </span><span class="lineNoCov">          0 :         if (pos &gt; 0 &amp;&amp; pos &lt;= 128) {</span></a>
<a name="177"><span class="lineNum">     177 </span><span class="lineNoCov">          0 :             out[pos - 4] *= hann_window[96];</span></a>
<a name="178"><span class="lineNum">     178 </span><span class="lineNoCov">          0 :             out[pos - 3] *= hann_window[64];</span></a>
<a name="179"><span class="lineNum">     179 </span><span class="lineNoCov">          0 :             out[pos - 2] *= hann_window[32];</span></a>
<a name="180"><span class="lineNum">     180 </span><span class="lineNoCov">          0 :             out[pos - 1] *= hann_window[0];</span></a>
<a name="181"><span class="lineNum">     181 </span><span class="lineNoCov">          0 :             memset(&amp;out[pos], 0, (128 - pos) * sizeof(out[pos]));</span></a>
<a name="182"><span class="lineNum">     182 </span>            :         }</a>
<a name="183"><span class="lineNum">     183 </span>            :     }</a>
<a name="184"><span class="lineNum">     184 </span><span class="lineNoCov">          0 : }</span></a>
<a name="185"><span class="lineNum">     185 </span>            : </a>
<a name="186"><span class="lineNum">     186 </span><span class="lineNoCov">          0 : void ff_atrac3p_generate_tones(Atrac3pChanUnitCtx *ch_unit, AVFloatDSPContext *fdsp,</span></a>
<a name="187"><span class="lineNum">     187 </span>            :                                int ch_num, int sb, float *out)</a>
<a name="188"><span class="lineNum">     188 </span>            : {</a>
<a name="189"><span class="lineNum">     189 </span><span class="lineNoCov">          0 :     DECLARE_ALIGNED(32, float, wavreg1)[128] = { 0 };</span></a>
<a name="190"><span class="lineNum">     190 </span><span class="lineNoCov">          0 :     DECLARE_ALIGNED(32, float, wavreg2)[128] = { 0 };</span></a>
<a name="191"><span class="lineNum">     191 </span><span class="lineNoCov">          0 :     int i, reg1_env_nonzero, reg2_env_nonzero;</span></a>
<a name="192"><span class="lineNum">     192 </span><span class="lineNoCov">          0 :     Atrac3pWavesData *tones_now  = &amp;ch_unit-&gt;channels[ch_num].tones_info_prev[sb];</span></a>
<a name="193"><span class="lineNum">     193 </span><span class="lineNoCov">          0 :     Atrac3pWavesData *tones_next = &amp;ch_unit-&gt;channels[ch_num].tones_info[sb];</span></a>
<a name="194"><span class="lineNum">     194 </span>            : </a>
<a name="195"><span class="lineNum">     195 </span>            :     /* reconstruct full envelopes for both overlapping regions</a>
<a name="196"><span class="lineNum">     196 </span>            :      * from truncated bitstream data */</a>
<a name="197"><span class="lineNum">     197 </span><span class="lineNoCov">          0 :     if (tones_next-&gt;pend_env.has_start_point &amp;&amp;</span></a>
<a name="198"><span class="lineNum">     198 </span><span class="lineNoCov">          0 :         tones_next-&gt;pend_env.start_pos &lt; tones_next-&gt;pend_env.stop_pos) {</span></a>
<a name="199"><span class="lineNum">     199 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_start_point = 1;</span></a>
<a name="200"><span class="lineNum">     200 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.start_pos       = tones_next-&gt;pend_env.start_pos + 32;</span></a>
<a name="201"><span class="lineNum">     201 </span><span class="lineNoCov">          0 :     } else if (tones_now-&gt;pend_env.has_start_point) {</span></a>
<a name="202"><span class="lineNum">     202 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_start_point = 1;</span></a>
<a name="203"><span class="lineNum">     203 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.start_pos       = tones_now-&gt;pend_env.start_pos;</span></a>
<a name="204"><span class="lineNum">     204 </span>            :     } else {</a>
<a name="205"><span class="lineNum">     205 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_start_point = 0;</span></a>
<a name="206"><span class="lineNum">     206 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.start_pos       = 0;</span></a>
<a name="207"><span class="lineNum">     207 </span>            :     }</a>
<a name="208"><span class="lineNum">     208 </span>            : </a>
<a name="209"><span class="lineNum">     209 </span><span class="lineNoCov">          0 :     if (tones_now-&gt;pend_env.has_stop_point &amp;&amp;</span></a>
<a name="210"><span class="lineNum">     210 </span><span class="lineNoCov">          0 :         tones_now-&gt;pend_env.stop_pos &gt;= tones_next-&gt;curr_env.start_pos) {</span></a>
<a name="211"><span class="lineNum">     211 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_stop_point = 1;</span></a>
<a name="212"><span class="lineNum">     212 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.stop_pos       = tones_now-&gt;pend_env.stop_pos;</span></a>
<a name="213"><span class="lineNum">     213 </span><span class="lineNoCov">          0 :     } else if (tones_next-&gt;pend_env.has_stop_point) {</span></a>
<a name="214"><span class="lineNum">     214 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_stop_point = 1;</span></a>
<a name="215"><span class="lineNum">     215 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.stop_pos       = tones_next-&gt;pend_env.stop_pos + 32;</span></a>
<a name="216"><span class="lineNum">     216 </span>            :     } else {</a>
<a name="217"><span class="lineNum">     217 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.has_stop_point = 0;</span></a>
<a name="218"><span class="lineNum">     218 </span><span class="lineNoCov">          0 :         tones_next-&gt;curr_env.stop_pos       = 64;</span></a>
<a name="219"><span class="lineNum">     219 </span>            :     }</a>
<a name="220"><span class="lineNum">     220 </span>            : </a>
<a name="221"><span class="lineNum">     221 </span>            :     /* is the visible part of the envelope non-zero? */</a>
<a name="222"><span class="lineNum">     222 </span><span class="lineNoCov">          0 :     reg1_env_nonzero = (tones_now-&gt;curr_env.stop_pos    &lt; 32) ? 0 : 1;</span></a>
<a name="223"><span class="lineNum">     223 </span><span class="lineNoCov">          0 :     reg2_env_nonzero = (tones_next-&gt;curr_env.start_pos &gt;= 32) ? 0 : 1;</span></a>
<a name="224"><span class="lineNum">     224 </span>            : </a>
<a name="225"><span class="lineNum">     225 </span>            :     /* synthesize waves for both overlapping regions */</a>
<a name="226"><span class="lineNum">     226 </span><span class="lineNoCov">          0 :     if (tones_now-&gt;num_wavs &amp;&amp; reg1_env_nonzero)</span></a>
<a name="227"><span class="lineNum">     227 </span><span class="lineNoCov">          0 :         waves_synth(ch_unit-&gt;waves_info_prev, tones_now, &amp;tones_now-&gt;curr_env,</span></a>
<a name="228"><span class="lineNum">     228 </span><span class="lineNoCov">          0 :                     fdsp, ch_unit-&gt;waves_info_prev-&gt;invert_phase[sb] &amp; ch_num,</span></a>
<a name="229"><span class="lineNum">     229 </span>            :                     128, wavreg1);</a>
<a name="230"><span class="lineNum">     230 </span>            : </a>
<a name="231"><span class="lineNum">     231 </span><span class="lineNoCov">          0 :     if (tones_next-&gt;num_wavs &amp;&amp; reg2_env_nonzero)</span></a>
<a name="232"><span class="lineNum">     232 </span><span class="lineNoCov">          0 :         waves_synth(ch_unit-&gt;waves_info, tones_next, &amp;tones_next-&gt;curr_env, fdsp,</span></a>
<a name="233"><span class="lineNum">     233 </span><span class="lineNoCov">          0 :                     ch_unit-&gt;waves_info-&gt;invert_phase[sb] &amp; ch_num, 0, wavreg2);</span></a>
<a name="234"><span class="lineNum">     234 </span>            : </a>
<a name="235"><span class="lineNum">     235 </span>            :     /* Hann windowing for non-faded wave signals */</a>
<a name="236"><span class="lineNum">     236 </span><span class="lineNoCov">          0 :     if (tones_now-&gt;num_wavs &amp;&amp; tones_next-&gt;num_wavs &amp;&amp;</span></a>
<a name="237"><span class="lineNum">     237 </span><span class="lineNoCov">          0 :         reg1_env_nonzero &amp;&amp; reg2_env_nonzero) {</span></a>
<a name="238"><span class="lineNum">     238 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul(wavreg1, wavreg1, &amp;hann_window[128], 128);</span></a>
<a name="239"><span class="lineNum">     239 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul(wavreg2, wavreg2,  hann_window,      128);</span></a>
<a name="240"><span class="lineNum">     240 </span>            :     } else {</a>
<a name="241"><span class="lineNum">     241 </span><span class="lineNoCov">          0 :         if (tones_now-&gt;num_wavs &amp;&amp; !tones_now-&gt;curr_env.has_stop_point)</span></a>
<a name="242"><span class="lineNum">     242 </span><span class="lineNoCov">          0 :             fdsp-&gt;vector_fmul(wavreg1, wavreg1, &amp;hann_window[128], 128);</span></a>
<a name="243"><span class="lineNum">     243 </span>            : </a>
<a name="244"><span class="lineNum">     244 </span><span class="lineNoCov">          0 :         if (tones_next-&gt;num_wavs &amp;&amp; !tones_next-&gt;curr_env.has_start_point)</span></a>
<a name="245"><span class="lineNum">     245 </span><span class="lineNoCov">          0 :             fdsp-&gt;vector_fmul(wavreg2, wavreg2, hann_window, 128);</span></a>
<a name="246"><span class="lineNum">     246 </span>            :     }</a>
<a name="247"><span class="lineNum">     247 </span>            : </a>
<a name="248"><span class="lineNum">     248 </span>            :     /* Overlap and add to residual */</a>
<a name="249"><span class="lineNum">     249 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 128; i++)</span></a>
<a name="250"><span class="lineNum">     250 </span><span class="lineNoCov">          0 :         out[i] += wavreg1[i] + wavreg2[i];</span></a>
<a name="251"><span class="lineNum">     251 </span><span class="lineNoCov">          0 : }</span></a>
<a name="252"><span class="lineNum">     252 </span>            : </a>
<a name="253"><span class="lineNum">     253 </span>            : static const uint8_t subband_to_powgrp[ATRAC3P_SUBBANDS] = {</a>
<a name="254"><span class="lineNum">     254 </span>            :     0, 1, 1, 2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4</a>
<a name="255"><span class="lineNum">     255 </span>            : };</a>
<a name="256"><span class="lineNum">     256 </span>            : </a>
<a name="257"><span class="lineNum">     257 </span>            : /* noise table for power compensation */</a>
<a name="258"><span class="lineNum">     258 </span>            : static const float noise_tab[1024] = {</a>
<a name="259"><span class="lineNum">     259 </span>            :     -0.01358032,  -0.05593872,   0.01696777,  -0.14871216,  -0.26412964,  -0.09893799,   0.25723267,</a>
<a name="260"><span class="lineNum">     260 </span>            :      0.02008057,  -0.72235107,  -0.44351196,  -0.22985840,   0.16833496,   0.46902466,   0.05917358,</a>
<a name="261"><span class="lineNum">     261 </span>            :     -0.15179443,   0.41299438,  -0.01287842,   0.13360596,   0.43557739,  -0.09530640,  -0.58422852,</a>
<a name="262"><span class="lineNum">     262 </span>            :      0.39266968,  -0.08343506,  -0.25604248,   0.22848511,   0.26013184,  -0.65588379,   0.17288208,</a>
<a name="263"><span class="lineNum">     263 </span>            :     -0.08673096,  -0.05203247,   0.07299805,  -0.28665161,  -0.35806274,   0.06552124,  -0.09387207,</a>
<a name="264"><span class="lineNum">     264 </span>            :      0.21099854,  -0.28347778,  -0.72402954,   0.05050659,  -0.10635376,  -0.18853760,   0.29724121,</a>
<a name="265"><span class="lineNum">     265 </span>            :      0.20703125,  -0.29791260,  -0.37634277,   0.47970581,  -0.09976196,   0.32641602,  -0.29248047,</a>
<a name="266"><span class="lineNum">     266 </span>            :     -0.28237915,   0.26028442,  -0.36157227,   0.22042847,  -0.03222656,  -0.37268066,  -0.03759766,</a>
<a name="267"><span class="lineNum">     267 </span>            :      0.09909058,   0.23284912,   0.19320679,   0.14453125,  -0.02139282,  -0.19702148,   0.31533813,</a>
<a name="268"><span class="lineNum">     268 </span>            :     -0.16741943,   0.35031128,  -0.35656738,  -0.66128540,  -0.00701904,   0.20898438,   0.26837158,</a>
<a name="269"><span class="lineNum">     269 </span>            :     -0.33706665,  -0.04568481,   0.12600708,   0.10284424,   0.07321167,  -0.18280029,   0.38101196,</a>
<a name="270"><span class="lineNum">     270 </span>            :      0.21301270,   0.04541016,   0.01156616,  -0.26391602,  -0.02346802,  -0.22125244,   0.29760742,</a>
<a name="271"><span class="lineNum">     271 </span>            :     -0.36233521,  -0.31314087,  -0.13967896,  -0.11276245,  -0.19433594,   0.34490967,   0.02343750,</a>
<a name="272"><span class="lineNum">     272 </span>            :      0.21963501,  -0.02777100,  -0.67678833,  -0.08999634,   0.14233398,  -0.27697754,   0.51422119,</a>
<a name="273"><span class="lineNum">     273 </span>            :     -0.05047607,   0.48327637,   0.37167358,  -0.60806274,   0.18728638,  -0.15191650,   0.00637817,</a>
<a name="274"><span class="lineNum">     274 </span>            :      0.02832031,  -0.15618896,   0.60644531,   0.21826172,   0.06384277,  -0.31863403,   0.08816528,</a>
<a name="275"><span class="lineNum">     275 </span>            :      0.15447998,  -0.07015991,  -0.08154297,  -0.40966797,  -0.39785767,  -0.11709595,   0.22052002,</a>
<a name="276"><span class="lineNum">     276 </span>            :      0.18466187,  -0.17257690,   0.03759766,  -0.06195068,   0.00433350,   0.12176514,   0.34011841,</a>
<a name="277"><span class="lineNum">     277 </span>            :      0.25610352,  -0.05294800,   0.41033936,   0.16854858,  -0.76187134,   0.13845825,  -0.19418335,</a>
<a name="278"><span class="lineNum">     278 </span>            :     -0.21524048,  -0.44412231,  -0.08160400,  -0.28195190,  -0.01873779,   0.15524292,  -0.37438965,</a>
<a name="279"><span class="lineNum">     279 </span>            :     -0.44860840,   0.43096924,  -0.24746704,   0.49856567,   0.14859009,   0.38159180,   0.20541382,</a>
<a name="280"><span class="lineNum">     280 </span>            :     -0.39175415,  -0.65850830,  -0.43716431,   0.13037109,  -0.05111694,   0.39956665,   0.21447754,</a>
<a name="281"><span class="lineNum">     281 </span>            :     -0.04861450,   0.33654785,   0.10589600,  -0.88085938,  -0.30822754,   0.38577271,   0.30047607,</a>
<a name="282"><span class="lineNum">     282 </span>            :      0.38836670,   0.09118652,  -0.36477661,  -0.01641846,  -0.23031616,   0.26058960,   0.18859863,</a>
<a name="283"><span class="lineNum">     283 </span>            :     -0.21868896,  -0.17861938,  -0.29754639,   0.09777832,   0.10806274,  -0.51605225,   0.00076294,</a>
<a name="284"><span class="lineNum">     284 </span>            :      0.13259888,   0.11090088,  -0.24084473,   0.24957275,   0.01379395,  -0.04141235,  -0.04937744,</a>
<a name="285"><span class="lineNum">     285 </span>            :      0.57394409,   0.27410889,   0.27587891,   0.45013428,  -0.32592773,   0.11160278,  -0.00970459,</a>
<a name="286"><span class="lineNum">     286 </span>            :      0.29092407,   0.03356934,  -0.70925903,   0.04882812,   0.43499756,   0.07720947,  -0.27554321,</a>
<a name="287"><span class="lineNum">     287 </span>            :     -0.01742554,  -0.08413696,  -0.04028320,  -0.52850342,  -0.07330322,   0.05181885,   0.21362305,</a>
<a name="288"><span class="lineNum">     288 </span>            :     -0.18765259,   0.07058716,  -0.03009033,   0.32662964,   0.27023315,  -0.28002930,   0.17568970,</a>
<a name="289"><span class="lineNum">     289 </span>            :      0.03338623,   0.30242920,  -0.03921509,   0.32174683,  -0.23733521,   0.08575439,  -0.38269043,</a>
<a name="290"><span class="lineNum">     290 </span>            :      0.09194946,  -0.07238770,   0.17941284,  -0.51278687,  -0.25146484,   0.19790649,  -0.19195557,</a>
<a name="291"><span class="lineNum">     291 </span>            :      0.16549683,   0.42456055,   0.39129639,  -0.02868652,   0.17980957,   0.24902344,  -0.76583862,</a>
<a name="292"><span class="lineNum">     292 </span>            :     -0.20959473,   0.61013794,   0.37011719,   0.36859131,  -0.04486084,   0.10678101,  -0.15994263,</a>
<a name="293"><span class="lineNum">     293 </span>            :     -0.05328369,   0.28463745,  -0.06420898,  -0.36987305,  -0.28009033,  -0.11764526,   0.04312134,</a>
<a name="294"><span class="lineNum">     294 </span>            :     -0.08038330,   0.04885864,  -0.03067017,  -0.00042725,   0.34289551,  -0.00988770,   0.34838867,</a>
<a name="295"><span class="lineNum">     295 </span>            :      0.32516479,  -0.16271973,   0.38269043,   0.03240967,   0.12417603,  -0.14331055,  -0.34902954,</a>
<a name="296"><span class="lineNum">     296 </span>            :     -0.18325806,   0.29421997,   0.44284058,   0.75170898,  -0.67245483,  -0.12176514,   0.27914429,</a>
<a name="297"><span class="lineNum">     297 </span>            :     -0.29806519,   0.19863892,   0.30087280,   0.22680664,  -0.36633301,  -0.32534790,  -0.57553101,</a>
<a name="298"><span class="lineNum">     298 </span>            :     -0.16641235,   0.43811035,   0.08331299,   0.15942383,   0.26516724,  -0.24240112,  -0.11761475,</a>
<a name="299"><span class="lineNum">     299 </span>            :     -0.16827393,  -0.14260864,   0.46343994,   0.11804199,  -0.55514526,  -0.02520752,  -0.14309692,</a>
<a name="300"><span class="lineNum">     300 </span>            :      0.00448608,   0.02749634,  -0.30545044,   0.70965576,   0.45108032,   0.66439819,  -0.68255615,</a>
<a name="301"><span class="lineNum">     301 </span>            :     -0.12496948,   0.09146118,  -0.21109009,  -0.23791504,   0.79943848,  -0.35205078,  -0.24963379,</a>
<a name="302"><span class="lineNum">     302 </span>            :      0.18719482,  -0.19079590,   0.07458496,   0.07623291,  -0.28781128,  -0.37121582,  -0.19580078,</a>
<a name="303"><span class="lineNum">     303 </span>            :     -0.01773071,  -0.16717529,   0.13040161,   0.14672852,   0.42379761,   0.03582764,   0.11431885,</a>
<a name="304"><span class="lineNum">     304 </span>            :      0.05145264,   0.44702148,   0.08963013,   0.01367188,  -0.54519653,  -0.12692261,   0.21176147,</a>
<a name="305"><span class="lineNum">     305 </span>            :      0.04925537,   0.30670166,  -0.11029053,   0.19555664,  -0.27740479,   0.23043823,   0.15554810,</a>
<a name="306"><span class="lineNum">     306 </span>            :     -0.19299316,  -0.25729370,   0.17800903,  -0.03579712,  -0.05065918,  -0.06933594,  -0.09500122,</a>
<a name="307"><span class="lineNum">     307 </span>            :     -0.07821655,   0.23889160,  -0.31900024,   0.03073120,  -0.00415039,   0.61315918,   0.37176514,</a>
<a name="308"><span class="lineNum">     308 </span>            :     -0.13442993,  -0.15536499,  -0.19216919,  -0.37899780,   0.19992065,   0.02630615,  -0.12573242,</a>
<a name="309"><span class="lineNum">     309 </span>            :      0.25927734,  -0.02447510,   0.29629517,  -0.40731812,  -0.17333984,   0.24310303,  -0.10607910,</a>
<a name="310"><span class="lineNum">     310 </span>            :      0.14828491,   0.08792114,  -0.18743896,  -0.05572510,  -0.04833984,   0.10473633,  -0.29028320,</a>
<a name="311"><span class="lineNum">     311 </span>            :     -0.67687988,  -0.28170776,  -0.41687012,   0.05413818,  -0.23284912,   0.09555054,  -0.08969116,</a>
<a name="312"><span class="lineNum">     312 </span>            :     -0.15112305,   0.12738037,   0.35986328,   0.28948975,   0.30691528,   0.23956299,   0.06973267,</a>
<a name="313"><span class="lineNum">     313 </span>            :     -0.31198120,  -0.18450928,   0.22280884,  -0.21600342,   0.23522949,  -0.61840820,  -0.13012695,</a>
<a name="314"><span class="lineNum">     314 </span>            :      0.26412964,   0.47320557,  -0.26440430,   0.38757324,   0.17352295,  -0.26104736,  -0.25866699,</a>
<a name="315"><span class="lineNum">     315 </span>            :     -0.12274170,  -0.29733276,   0.07687378,   0.18588257,  -0.08880615,   0.31185913,   0.05313110,</a>
<a name="316"><span class="lineNum">     316 </span>            :     -0.10885620,  -0.14901733,  -0.22323608,  -0.08538818,   0.19812012,   0.19732666,  -0.18927002,</a>
<a name="317"><span class="lineNum">     317 </span>            :      0.29058838,   0.25555420,  -0.48599243,   0.18768311,   0.01345825,   0.34887695,   0.21530151,</a>
<a name="318"><span class="lineNum">     318 </span>            :      0.19857788,   0.18661499,  -0.01394653,  -0.09063721,  -0.38781738,   0.27160645,  -0.20379639,</a>
<a name="319"><span class="lineNum">     319 </span>            :     -0.32119751,  -0.23889160,   0.27096558,   0.24951172,   0.07922363,   0.07479858,  -0.50946045,</a>
<a name="320"><span class="lineNum">     320 </span>            :      0.10220337,   0.58364868,  -0.19503784,  -0.18560791,  -0.01165771,   0.47195435,   0.22430420,</a>
<a name="321"><span class="lineNum">     321 </span>            :     -0.38635254,  -0.03732300,  -0.09179688,   0.06991577,   0.15106201,   0.20605469,  -0.05969238,</a>
<a name="322"><span class="lineNum">     322 </span>            :     -0.41821289,   0.12231445,  -0.04672241,  -0.05117798,  -0.11523438,  -0.51849365,  -0.04077148,</a>
<a name="323"><span class="lineNum">     323 </span>            :      0.44284058,  -0.64086914,   0.17019653,   0.02236938,   0.22848511,  -0.23214722,  -0.32354736,</a>
<a name="324"><span class="lineNum">     324 </span>            :     -0.14068604,  -0.29690552,  -0.19891357,   0.02774048,  -0.20965576,  -0.52191162,  -0.19299316,</a>
<a name="325"><span class="lineNum">     325 </span>            :     -0.07290649,   0.49053955,  -0.22302246,   0.05642700,   0.13122559,  -0.20819092,  -0.83590698,</a>
<a name="326"><span class="lineNum">     326 </span>            :     -0.08181763,   0.26797485,  -0.00091553,  -0.09457397,   0.17089844,  -0.27020264,   0.30270386,</a>
<a name="327"><span class="lineNum">     327 </span>            :      0.05496216,   0.09564209,  -0.08590698,   0.02130127,   0.35931396,   0.21728516,  -0.15396118,</a>
<a name="328"><span class="lineNum">     328 </span>            :     -0.05053711,   0.02719116,   0.16302490,   0.43212891,   0.10229492,  -0.40820312,   0.21646118,</a>
<a name="329"><span class="lineNum">     329 </span>            :      0.08435059,  -0.11145020,  -0.39962769,  -0.05618286,  -0.10223389,  -0.60839844,   0.33724976,</a>
<a name="330"><span class="lineNum">     330 </span>            :     -0.06341553,  -0.47369385,  -0.32852173,   0.05242920,   0.19635010,  -0.19137573,  -0.67901611,</a>
<a name="331"><span class="lineNum">     331 </span>            :      0.16180420,   0.05133057,  -0.22283936,   0.09646606,   0.24288940,  -0.45007324,   0.08804321,</a>
<a name="332"><span class="lineNum">     332 </span>            :      0.14053345,   0.22619629,  -0.01000977,   0.36355591,  -0.19863892,  -0.30364990,  -0.24118042,</a>
<a name="333"><span class="lineNum">     333 </span>            :     -0.57461548,   0.26498413,   0.04345703,  -0.09796143,  -0.47714233,  -0.23739624,   0.18737793,</a>
<a name="334"><span class="lineNum">     334 </span>            :      0.08926392,  -0.02795410,   0.00305176,  -0.08700562,  -0.38711548,   0.03222656,   0.10940552,</a>
<a name="335"><span class="lineNum">     335 </span>            :     -0.41906738,  -0.01620483,  -0.47061157,   0.37985229,  -0.21624756,   0.47976685,  -0.20046997,</a>
<a name="336"><span class="lineNum">     336 </span>            :     -0.62533569,  -0.26907349,  -0.02877808,   0.00671387,  -0.29071045,  -0.24685669,  -0.15722656,</a>
<a name="337"><span class="lineNum">     337 </span>            :     -0.26055908,   0.29968262,   0.28225708,  -0.08990479,  -0.16748047,  -0.46759033,  -0.25067139,</a>
<a name="338"><span class="lineNum">     338 </span>            :     -0.25183105,  -0.45932007,   0.05828857,   0.29006958,   0.23840332,  -0.17974854,   0.26931763,</a>
<a name="339"><span class="lineNum">     339 </span>            :      0.10696411,  -0.06848145,  -0.17126465,  -0.10522461,  -0.55386353,  -0.42306519,  -0.07608032,</a>
<a name="340"><span class="lineNum">     340 </span>            :      0.24380493,   0.38586426,   0.16882324,   0.26751709,   0.17303467,   0.35809326,  -0.22094727,</a>
<a name="341"><span class="lineNum">     341 </span>            :     -0.30703735,  -0.28497314,  -0.04321289,   0.15219116,  -0.17071533,  -0.39334106,   0.03439331,</a>
<a name="342"><span class="lineNum">     342 </span>            :     -0.10809326,  -0.30590820,   0.26449585,  -0.07412720,   0.13638306,  -0.01062012,   0.27996826,</a>
<a name="343"><span class="lineNum">     343 </span>            :      0.04397583,  -0.05557251,  -0.56933594,   0.03363037,  -0.00949097,   0.52642822,  -0.44329834,</a>
<a name="344"><span class="lineNum">     344 </span>            :      0.28308105,  -0.05499268,  -0.23312378,  -0.29870605,  -0.05123901,   0.26831055,  -0.35238647,</a>
<a name="345"><span class="lineNum">     345 </span>            :     -0.30993652,   0.34646606,  -0.19775391,   0.44595337,   0.13769531,   0.45358276,   0.19961548,</a>
<a name="346"><span class="lineNum">     346 </span>            :      0.42681885,   0.15722656,   0.00128174,   0.23757935,   0.40988159,   0.25164795,  -0.00732422,</a>
<a name="347"><span class="lineNum">     347 </span>            :     -0.12405396,  -0.43420410,  -0.00402832,   0.34243774,   0.36264038,   0.18807983,  -0.09301758,</a>
<a name="348"><span class="lineNum">     348 </span>            :     -0.10296631,   0.05532837,  -0.31652832,   0.14337158,   0.35040283,   0.32540894,   0.05728149,</a>
<a name="349"><span class="lineNum">     349 </span>            :     -0.12030029,  -0.25942993,  -0.20312500,  -0.16491699,  -0.46051025,  -0.08004761,   0.50772095,</a>
<a name="350"><span class="lineNum">     350 </span>            :      0.16168213,   0.28439331,   0.08105469,  -0.19104004,   0.38589478,  -0.16400146,  -0.25454712,</a>
<a name="351"><span class="lineNum">     351 </span>            :      0.20281982,  -0.20730591,  -0.06311035,   0.32937622,   0.15032959,  -0.05340576,   0.30487061,</a>
<a name="352"><span class="lineNum">     352 </span>            :     -0.11648560,   0.38009644,  -0.20062256,   0.43466187,   0.01150513,   0.35754395,  -0.13146973,</a>
<a name="353"><span class="lineNum">     353 </span>            :      0.67489624,   0.05212402,   0.27914429,  -0.39431763,   0.75308228,  -0.13366699,   0.24453735,</a>
<a name="354"><span class="lineNum">     354 </span>            :      0.42248535,  -0.65905762,  -0.00546265,  -0.03491211,  -0.13659668,  -0.08294678,  -0.45666504,</a>
<a name="355"><span class="lineNum">     355 </span>            :      0.27188110,   0.12731934,   0.61148071,   0.10449219,  -0.28836060,   0.00091553,   0.24618530,</a>
<a name="356"><span class="lineNum">     356 </span>            :      0.13119507,   0.05685425,   0.17355347,   0.42034912,   0.08514404,   0.24536133,   0.18951416,</a>
<a name="357"><span class="lineNum">     357 </span>            :     -0.19107056,  -0.15036011,   0.02334595,   0.54986572,   0.32321167,  -0.16104126,  -0.03054810,</a>
<a name="358"><span class="lineNum">     358 </span>            :      0.43594360,   0.17309570,   0.61053467,   0.24731445,   0.33334351,   0.15240479,   0.15588379,</a>
<a name="359"><span class="lineNum">     359 </span>            :      0.36425781,  -0.30407715,  -0.13302612,   0.00427246,   0.04171753,  -0.33178711,   0.34216309,</a>
<a name="360"><span class="lineNum">     360 </span>            :     -0.12463379,  -0.02764893,   0.05905151,  -0.31436157,   0.16531372,   0.34542847,  -0.03292847,</a>
<a name="361"><span class="lineNum">     361 </span>            :      0.12527466,  -0.12313843,  -0.13171387,   0.04757690,  -0.45095825,  -0.19085693,   0.35342407,</a>
<a name="362"><span class="lineNum">     362 </span>            :     -0.23239136,  -0.34387207,   0.11264038,  -0.15740967,   0.05273438,   0.74942017,   0.21505737,</a>
<a name="363"><span class="lineNum">     363 </span>            :      0.08514404,  -0.42391968,  -0.19531250,   0.35293579,   0.25305176,   0.15731812,  -0.70324707,</a>
<a name="364"><span class="lineNum">     364 </span>            :     -0.21591187,   0.35604858,   0.14132690,   0.11724854,   0.15853882,  -0.24597168,   0.07019043,</a>
<a name="365"><span class="lineNum">     365 </span>            :      0.02127075,   0.12658691,   0.06390381,  -0.12292480,   0.15441895,  -0.47640991,   0.06195068,</a>
<a name="366"><span class="lineNum">     366 </span>            :      0.58981323,  -0.15151978,  -0.03604126,  -0.45059204,  -0.01672363,  -0.46997070,   0.25750732,</a>
<a name="367"><span class="lineNum">     367 </span>            :      0.18084717,   0.06661987,   0.13253784,   0.67828369,   0.11370850,   0.11325073,  -0.04611206,</a>
<a name="368"><span class="lineNum">     368 </span>            :     -0.07791138,  -0.36544800,  -0.06747437,  -0.31594849,   0.16131592,   0.41983032,   0.11071777,</a>
<a name="369"><span class="lineNum">     369 </span>            :     -0.36889648,   0.30963135,  -0.37875366,   0.58508301,   0.00393677,   0.12338257,   0.03424072,</a>
<a name="370"><span class="lineNum">     370 </span>            :     -0.21728516,  -0.12838745,  -0.46981812,   0.05868530,  -0.25015259,   0.27407837,   0.65240479,</a>
<a name="371"><span class="lineNum">     371 </span>            :     -0.34429932,  -0.15179443,   0.14056396,   0.33505249,   0.28826904,   0.09921265,   0.34390259,</a>
<a name="372"><span class="lineNum">     372 </span>            :      0.13656616,  -0.23608398,   0.00863647,   0.02627563,  -0.19119263,   0.19775391,  -0.07214355,</a>
<a name="373"><span class="lineNum">     373 </span>            :      0.07809448,   0.03454590,  -0.03417969,   0.00033569,  -0.23095703,   0.18673706,   0.05798340,</a>
<a name="374"><span class="lineNum">     374 </span>            :      0.03814697,  -0.04318237,   0.05487061,   0.08633423,   0.55950928,  -0.06347656,   0.10333252,</a>
<a name="375"><span class="lineNum">     375 </span>            :      0.25305176,   0.05853271,   0.12246704,  -0.25543213,  -0.34262085,  -0.36437988,  -0.21304321,</a>
<a name="376"><span class="lineNum">     376 </span>            :     -0.05093384,   0.02777100,   0.07620239,  -0.21215820,  -0.09326172,   0.19021606,  -0.40579224,</a>
<a name="377"><span class="lineNum">     377 </span>            :     -0.01193237,   0.19845581,  -0.35336304,  -0.07397461,   0.20104980,   0.08615112,  -0.44375610,</a>
<a name="378"><span class="lineNum">     378 </span>            :      0.11419678,   0.24453735,  -0.16555786,  -0.05081177,  -0.01406860,   0.27893066,  -0.18692017,</a>
<a name="379"><span class="lineNum">     379 </span>            :      0.07473755,   0.03451538,  -0.39733887,   0.21548462,  -0.22534180,  -0.39651489,  -0.04989624,</a>
<a name="380"><span class="lineNum">     380 </span>            :     -0.57662964,   0.06390381,   0.62020874,  -0.13470459,   0.04345703,  -0.21862793,  -0.02789307,</a>
<a name="381"><span class="lineNum">     381 </span>            :      0.51696777,  -0.27587891,   0.39004517,   0.09857178,  -0.00738525,   0.31317139,   0.00048828,</a>
<a name="382"><span class="lineNum">     382 </span>            :     -0.46572876,   0.29531860,  -0.10009766,  -0.27856445,   0.03594971,   0.25048828,  -0.74584961,</a>
<a name="383"><span class="lineNum">     383 </span>            :     -0.25350952,  -0.03302002,   0.31188965,   0.01571655,   0.46710205,   0.21591187,   0.07260132,</a>
<a name="384"><span class="lineNum">     384 </span>            :     -0.42132568,  -0.53900146,  -0.13674927,  -0.16571045,  -0.34454346,   0.12359619,  -0.11184692,</a>
<a name="385"><span class="lineNum">     385 </span>            :      0.00967407,   0.34576416,  -0.05761719,   0.34848022,   0.17645264,  -0.39395142,   0.10339355,</a>
<a name="386"><span class="lineNum">     386 </span>            :      0.18215942,   0.20697021,   0.59109497,  -0.11560059,  -0.07385254,   0.10397339,   0.35437012,</a>
<a name="387"><span class="lineNum">     387 </span>            :     -0.22863770,   0.01794434,   0.17559814,  -0.17495728,   0.12142944,   0.10928345,  -1.00000000,</a>
<a name="388"><span class="lineNum">     388 </span>            :     -0.01379395,   0.21237183,  -0.27035522,   0.27319336,  -0.37066650,   0.41354370,  -0.40054321,</a>
<a name="389"><span class="lineNum">     389 </span>            :      0.00689697,   0.26321411,   0.39266968,   0.65298462,   0.41625977,  -0.13909912,   0.78375244,</a>
<a name="390"><span class="lineNum">     390 </span>            :     -0.30941772,   0.20169067,  -0.39367676,   0.94021606,  -0.24066162,   0.05557251,  -0.24533081,</a>
<a name="391"><span class="lineNum">     391 </span>            :     -0.05444336,  -0.76754761,  -0.19375610,  -0.11041260,  -0.17532349,   0.16006470,   0.02188110,</a>
<a name="392"><span class="lineNum">     392 </span>            :      0.17465210,  -0.04342651,  -0.56777954,  -0.40988159,   0.26687622,   0.11700439,  -0.00344849,</a>
<a name="393"><span class="lineNum">     393 </span>            :     -0.05395508,   0.37426758,  -0.40719604,  -0.15032959,  -0.01660156,   0.04196167,  -0.04559326,</a>
<a name="394"><span class="lineNum">     394 </span>            :     -0.12969971,   0.12011719,   0.08419800,  -0.11199951,   0.35174561,   0.10275269,  -0.25686646,</a>
<a name="395"><span class="lineNum">     395 </span>            :      0.48446655,   0.03225708,   0.28408813,  -0.18701172,   0.36282349,  -0.03280640,   0.32302856,</a>
<a name="396"><span class="lineNum">     396 </span>            :      0.17233276,   0.48269653,   0.31112671,  -0.04946899,   0.12774658,   0.52685547,   0.10211182,</a>
<a name="397"><span class="lineNum">     397 </span>            :      0.05953979,   0.05999756,   0.20144653,   0.00744629,   0.27316284,   0.24377441,   0.39672852,</a>
<a name="398"><span class="lineNum">     398 </span>            :      0.01702881,  -0.35513306,   0.11364746,  -0.13555908,   0.48880005,  -0.15417480,  -0.09149170,</a>
<a name="399"><span class="lineNum">     399 </span>            :     -0.02615356,   0.46246338,  -0.72250366,   0.22332764,   0.23849487,  -0.25686646,  -0.08514404,</a>
<a name="400"><span class="lineNum">     400 </span>            :     -0.02062988,  -0.34494019,  -0.02297974,  -0.80386353,  -0.08074951,  -0.12689209,  -0.06896973,</a>
<a name="401"><span class="lineNum">     401 </span>            :      0.24099731,  -0.35650635,  -0.09558105,   0.29254150,   0.23132324,  -0.16726685,   0.00000000,</a>
<a name="402"><span class="lineNum">     402 </span>            :     -0.24237061,   0.30899048,   0.29504395,  -0.20898438,   0.17059326,  -0.07672119,  -0.14395142,</a>
<a name="403"><span class="lineNum">     403 </span>            :      0.05572510,   0.20602417,  -0.51550293,  -0.03167725,  -0.48840332,  -0.20425415,   0.14144897,</a>
<a name="404"><span class="lineNum">     404 </span>            :      0.07275391,  -0.76669312,  -0.22488403,   0.20651245,   0.03259277,   0.00085449,   0.03039551,</a>
<a name="405"><span class="lineNum">     405 </span>            :      0.47555542,   0.38351440</a>
<a name="406"><span class="lineNum">     406 </span>            : };</a>
<a name="407"><span class="lineNum">     407 </span>            : </a>
<a name="408"><span class="lineNum">     408 </span>            : /** Noise level table for power compensation.</a>
<a name="409"><span class="lineNum">     409 </span>            :  *  Equ: pow(2.0f, (double)(6 - i) / 3.0f) where i = 0...15 */</a>
<a name="410"><span class="lineNum">     410 </span>            : static const float pwc_levs[16] = {</a>
<a name="411"><span class="lineNum">     411 </span>            :     3.96875, 3.15625,     2.5,    2.0, 1.59375,   1.25,     1.0, 0.78125,</a>
<a name="412"><span class="lineNum">     412 </span>            :     0.625,       0.5, 0.40625, 0.3125,    0.25, 0.1875, 0.15625, 0.0</a>
<a name="413"><span class="lineNum">     413 </span>            : };</a>
<a name="414"><span class="lineNum">     414 </span>            : </a>
<a name="415"><span class="lineNum">     415 </span>            : /** Map subband number to quant unit number. */</a>
<a name="416"><span class="lineNum">     416 </span>            : static const uint8_t subband_to_qu[17] = {</a>
<a name="417"><span class="lineNum">     417 </span>            :     0, 8, 12, 16, 18, 20, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32</a>
<a name="418"><span class="lineNum">     418 </span>            : };</a>
<a name="419"><span class="lineNum">     419 </span>            : </a>
<a name="420"><span class="lineNum">     420 </span><span class="lineNoCov">          0 : void ff_atrac3p_power_compensation(Atrac3pChanUnitCtx *ctx, AVFloatDSPContext *fdsp,</span></a>
<a name="421"><span class="lineNum">     421 </span>            :                                    int ch_index, float *sp, int rng_index, int sb)</a>
<a name="422"><span class="lineNum">     422 </span>            : {</a>
<a name="423"><span class="lineNum">     423 </span><span class="lineNoCov">          0 :     AtracGainInfo *g1, *g2;</span></a>
<a name="424"><span class="lineNum">     424 </span><span class="lineNoCov">          0 :     LOCAL_ALIGNED_32(float, pwcsp, [ATRAC3P_SUBBAND_SAMPLES]);</span></a>
<a name="425"><span class="lineNum">     425 </span><span class="lineNoCov">          0 :     float *dst, grp_lev, qu_lev;</span></a>
<a name="426"><span class="lineNum">     426 </span><span class="lineNoCov">          0 :     int i, gain_lev, gcv = 0, qu, nsp;</span></a>
<a name="427"><span class="lineNum">     427 </span><span class="lineNoCov">          0 :     int swap_ch = (ctx-&gt;unit_type == CH_UNIT_STEREO &amp;&amp; ctx-&gt;swap_channels[sb]) ? 1 : 0;</span></a>
<a name="428"><span class="lineNum">     428 </span>            : </a>
<a name="429"><span class="lineNum">     429 </span><span class="lineNoCov">          0 :     if (ctx-&gt;channels[ch_index ^ swap_ch].power_levs[subband_to_powgrp[sb]] == ATRAC3P_POWER_COMP_OFF)</span></a>
<a name="430"><span class="lineNum">     430 </span><span class="lineNoCov">          0 :         return;</span></a>
<a name="431"><span class="lineNum">     431 </span>            : </a>
<a name="432"><span class="lineNum">     432 </span>            :     /* generate initial noise spectrum */</a>
<a name="433"><span class="lineNum">     433 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; ATRAC3P_SUBBAND_SAMPLES; i++, rng_index++)</span></a>
<a name="434"><span class="lineNum">     434 </span><span class="lineNoCov">          0 :         pwcsp[i] = noise_tab[rng_index &amp; 0x3FF];</span></a>
<a name="435"><span class="lineNum">     435 </span>            : </a>
<a name="436"><span class="lineNum">     436 </span>            :     /* check gain control information */</a>
<a name="437"><span class="lineNum">     437 </span><span class="lineNoCov">          0 :     g1 = &amp;ctx-&gt;channels[ch_index ^ swap_ch].gain_data[sb];</span></a>
<a name="438"><span class="lineNum">     438 </span><span class="lineNoCov">          0 :     g2 = &amp;ctx-&gt;channels[ch_index ^ swap_ch].gain_data_prev[sb];</span></a>
<a name="439"><span class="lineNum">     439 </span>            : </a>
<a name="440"><span class="lineNum">     440 </span><span class="lineNoCov">          0 :     gain_lev = (g1-&gt;num_points &gt; 0) ? (6 - g1-&gt;lev_code[0]) : 0;</span></a>
<a name="441"><span class="lineNum">     441 </span>            : </a>
<a name="442"><span class="lineNum">     442 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; g2-&gt;num_points; i++)</span></a>
<a name="443"><span class="lineNum">     443 </span><span class="lineNoCov">          0 :         gcv = FFMAX(gcv, gain_lev - (g2-&gt;lev_code[i] - 6));</span></a>
<a name="444"><span class="lineNum">     444 </span>            : </a>
<a name="445"><span class="lineNum">     445 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; g1-&gt;num_points; i++)</span></a>
<a name="446"><span class="lineNum">     446 </span><span class="lineNoCov">          0 :         gcv = FFMAX(gcv, 6 - g1-&gt;lev_code[i]);</span></a>
<a name="447"><span class="lineNum">     447 </span>            : </a>
<a name="448"><span class="lineNum">     448 </span><span class="lineNoCov">          0 :     grp_lev = pwc_levs[ctx-&gt;channels[ch_index ^ swap_ch].power_levs[subband_to_powgrp[sb]]] / (1 &lt;&lt; gcv);</span></a>
<a name="449"><span class="lineNum">     449 </span>            : </a>
<a name="450"><span class="lineNum">     450 </span>            :     /* skip the lowest two quant units (frequencies 0...351 Hz) for subband 0 */</a>
<a name="451"><span class="lineNum">     451 </span><span class="lineNoCov">          0 :     for (qu = subband_to_qu[sb] + (!sb ? 2 : 0); qu &lt; subband_to_qu[sb + 1]; qu++) {</span></a>
<a name="452"><span class="lineNum">     452 </span><span class="lineNoCov">          0 :         if (ctx-&gt;channels[ch_index].qu_wordlen[qu] &lt;= 0)</span></a>
<a name="453"><span class="lineNum">     453 </span><span class="lineNoCov">          0 :             continue;</span></a>
<a name="454"><span class="lineNum">     454 </span>            : </a>
<a name="455"><span class="lineNum">     455 </span><span class="lineNoCov">          0 :         qu_lev = ff_atrac3p_sf_tab[ctx-&gt;channels[ch_index].qu_sf_idx[qu]] *</span></a>
<a name="456"><span class="lineNum">     456 </span><span class="lineNoCov">          0 :                  ff_atrac3p_mant_tab[ctx-&gt;channels[ch_index].qu_wordlen[qu]] /</span></a>
<a name="457"><span class="lineNum">     457 </span><span class="lineNoCov">          0 :                  (1 &lt;&lt; ctx-&gt;channels[ch_index].qu_wordlen[qu]) * grp_lev;</span></a>
<a name="458"><span class="lineNum">     458 </span>            : </a>
<a name="459"><span class="lineNum">     459 </span><span class="lineNoCov">          0 :         dst = &amp;sp[ff_atrac3p_qu_to_spec_pos[qu]];</span></a>
<a name="460"><span class="lineNum">     460 </span><span class="lineNoCov">          0 :         nsp = ff_atrac3p_qu_to_spec_pos[qu + 1] - ff_atrac3p_qu_to_spec_pos[qu];</span></a>
<a name="461"><span class="lineNum">     461 </span>            : </a>
<a name="462"><span class="lineNum">     462 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmac_scalar(dst, pwcsp, qu_lev, nsp);</span></a>
<a name="463"><span class="lineNum">     463 </span>            :     }</a>
<a name="464"><span class="lineNum">     464 </span>            : }</a>
<a name="465"><span class="lineNum">     465 </span>            : </a>
<a name="466"><span class="lineNum">     466 </span><span class="lineNoCov">          0 : void ff_atrac3p_imdct(AVFloatDSPContext *fdsp, FFTContext *mdct_ctx, float *pIn,</span></a>
<a name="467"><span class="lineNum">     467 </span>            :                       float *pOut, int wind_id, int sb)</a>
<a name="468"><span class="lineNum">     468 </span>            : {</a>
<a name="469"><span class="lineNum">     469 </span><span class="lineNoCov">          0 :     int i;</span></a>
<a name="470"><span class="lineNum">     470 </span>            : </a>
<a name="471"><span class="lineNum">     471 </span><span class="lineNoCov">          0 :     if (sb &amp; 1)</span></a>
<a name="472"><span class="lineNum">     472 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; ATRAC3P_SUBBAND_SAMPLES / 2; i++)</span></a>
<a name="473"><span class="lineNum">     473 </span><span class="lineNoCov">          0 :             FFSWAP(float, pIn[i], pIn[ATRAC3P_SUBBAND_SAMPLES - 1 - i]);</span></a>
<a name="474"><span class="lineNum">     474 </span>            : </a>
<a name="475"><span class="lineNum">     475 </span><span class="lineNoCov">          0 :     mdct_ctx-&gt;imdct_calc(mdct_ctx, pOut, pIn);</span></a>
<a name="476"><span class="lineNum">     476 </span>            : </a>
<a name="477"><span class="lineNum">     477 </span>            :     /* Perform windowing on the output.</a>
<a name="478"><span class="lineNum">     478 </span>            :      * ATRAC3+ uses two different MDCT windows:</a>
<a name="479"><span class="lineNum">     479 </span>            :      * - The first one is just the plain sine window of size 256</a>
<a name="480"><span class="lineNum">     480 </span>            :      * - The 2nd one is the plain sine window of size 128</a>
<a name="481"><span class="lineNum">     481 </span>            :      *   wrapped into zero (at the start) and one (at the end) regions.</a>
<a name="482"><span class="lineNum">     482 </span>            :      *   Both regions are 32 samples long. */</a>
<a name="483"><span class="lineNum">     483 </span><span class="lineNoCov">          0 :     if (wind_id &amp; 2) { /* 1st half: steep window */</span></a>
<a name="484"><span class="lineNum">     484 </span><span class="lineNoCov">          0 :         memset(pOut, 0, sizeof(float) * 32);</span></a>
<a name="485"><span class="lineNum">     485 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul(&amp;pOut[32], &amp;pOut[32], ff_sine_64, 64);</span></a>
<a name="486"><span class="lineNum">     486 </span>            :     } else /* 1st half: simple sine window */</a>
<a name="487"><span class="lineNum">     487 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul(pOut, pOut, ff_sine_128, ATRAC3P_MDCT_SIZE / 2);</span></a>
<a name="488"><span class="lineNum">     488 </span>            : </a>
<a name="489"><span class="lineNum">     489 </span><span class="lineNoCov">          0 :     if (wind_id &amp; 1) { /* 2nd half: steep window */</span></a>
<a name="490"><span class="lineNum">     490 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul_reverse(&amp;pOut[160], &amp;pOut[160], ff_sine_64, 64);</span></a>
<a name="491"><span class="lineNum">     491 </span><span class="lineNoCov">          0 :         memset(&amp;pOut[224], 0, sizeof(float) * 32);</span></a>
<a name="492"><span class="lineNum">     492 </span>            :     } else /* 2nd half: simple sine window */</a>
<a name="493"><span class="lineNum">     493 </span><span class="lineNoCov">          0 :         fdsp-&gt;vector_fmul_reverse(&amp;pOut[128], &amp;pOut[128], ff_sine_128,</span></a>
<a name="494"><span class="lineNum">     494 </span>            :                                   ATRAC3P_MDCT_SIZE / 2);</a>
<a name="495"><span class="lineNum">     495 </span><span class="lineNoCov">          0 : }</span></a>
<a name="496"><span class="lineNum">     496 </span>            : </a>
<a name="497"><span class="lineNum">     497 </span>            : /* lookup table for fast modulo 23 op required for cyclic buffers of the IPQF */</a>
<a name="498"><span class="lineNum">     498 </span>            : static const int mod23_lut[26] = {</a>
<a name="499"><span class="lineNum">     499 </span>            :     23,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11,</a>
<a name="500"><span class="lineNum">     500 </span>            :     12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0</a>
<a name="501"><span class="lineNum">     501 </span>            : };</a>
<a name="502"><span class="lineNum">     502 </span>            : </a>
<a name="503"><span class="lineNum">     503 </span>            : /* First half of the 384-tap IPQF filtering coefficients. */</a>
<a name="504"><span class="lineNum">     504 </span>            : static const float ipqf_coeffs1[ATRAC3P_PQF_FIR_LEN][16] = {</a>
<a name="505"><span class="lineNum">     505 </span>            :     { -5.8336207e-7,    -8.0604229e-7,    -4.2005411e-7,    -4.4400572e-8,</a>
<a name="506"><span class="lineNum">     506 </span>            :        3.226247e-8,      3.530856e-8,      1.2660377e-8,     0.000010516783,</a>
<a name="507"><span class="lineNum">     507 </span>            :       -0.000011838618,   6.005389e-7,      0.0000014333754,  0.0000023108685,</a>
<a name="508"><span class="lineNum">     508 </span>            :        0.0000032569742,  0.0000046192422,  0.0000063894258,  0.0000070302972 },</a>
<a name="509"><span class="lineNum">     509 </span>            :     { -0.0000091622824, -0.000010502935,  -0.0000079212787, -0.0000041712024,</a>
<a name="510"><span class="lineNum">     510 </span>            :       -0.0000026336629, -0.0000015432918, -5.7168614e-7,     0.0000018111954,</a>
<a name="511"><span class="lineNum">     511 </span>            :        0.000023530851,   0.00002780562,    0.000032302323,   0.000036968919,</a>
<a name="512"><span class="lineNum">     512 </span>            :        0.000041575615,   0.000045337845,   0.000046043948,   0.000048585582 },</a>
<a name="513"><span class="lineNum">     513 </span>            :     { -0.000064464548,  -0.000068306952,  -0.000073081472,  -0.00007612785,</a>
<a name="514"><span class="lineNum">     514 </span>            :       -0.000074850752,  -0.000070208509,  -0.000062285151,  -0.000058270442,</a>
<a name="515"><span class="lineNum">     515 </span>            :       -0.000056296329,  -0.000049888811,  -0.000035615325,  -0.000018532943,</a>
<a name="516"><span class="lineNum">     516 </span>            :        0.0000016657353,  0.00002610587,    0.000053397067,   0.00008079566 },</a>
<a name="517"><span class="lineNum">     517 </span>            :     { -0.00054488552,   -0.00052537228,   -0.00049731287,   -0.00045778,</a>
<a name="518"><span class="lineNum">     518 </span>            :       -0.00040612387,   -0.00034301577,   -0.00026866337,   -0.00018248901,</a>
<a name="519"><span class="lineNum">     519 </span>            :       -0.000084307925,   0.000025081157,   0.00014135583,    0.00026649953,</a>
<a name="520"><span class="lineNum">     520 </span>            :        0.00039945057,    0.00053928449,    0.00068422867,    0.00083093712 },</a>
<a name="521"><span class="lineNum">     521 </span>            :     { -0.0014771431,    -0.001283227,     -0.0010566821,    -0.00079780724,</a>
<a name="522"><span class="lineNum">     522 </span>            :       -0.00050782406,   -0.00018855913,    0.00015771533,    0.00052769453,</a>
<a name="523"><span class="lineNum">     523 </span>            :        0.00091862219,    0.001326357,      0.0017469483,     0.0021754825,</a>
<a name="524"><span class="lineNum">     524 </span>            :        0.0026067684,     0.0030352892,     0.0034549395,     0.0038591374 },</a>
<a name="525"><span class="lineNum">     525 </span>            :     { -0.0022995141,    -0.001443546,     -0.00049266568,    0.00055068987,</a>
<a name="526"><span class="lineNum">     526 </span>            :        0.001682895,      0.0028992873,     0.0041943151,     0.0055614738,</a>
<a name="527"><span class="lineNum">     527 </span>            :        0.0069935122,     0.0084823566,     0.010018963,      0.011593862,</a>
<a name="528"><span class="lineNum">     528 </span>            :        0.013196872,      0.014817309,      0.016444042,      0.018065533 },</a>
<a name="529"><span class="lineNum">     529 </span>            :     { -0.034426283,     -0.034281436,     -0.033992987,     -0.033563249,</a>
<a name="530"><span class="lineNum">     530 </span>            :       -0.032995768,     -0.032295227,     -0.031467363,     -0.030518902,</a>
<a name="531"><span class="lineNum">     531 </span>            :       -0.02945766,      -0.028291954,     -0.027031265,     -0.025685543,</a>
<a name="532"><span class="lineNum">     532 </span>            :       -0.024265358,     -0.022781773,     -0.021246184,     -0.019670162 },</a>
<a name="533"><span class="lineNum">     533 </span>            :     { -0.0030586775,    -0.0037203205,    -0.0042847847,    -0.0047529764,</a>
<a name="534"><span class="lineNum">     534 </span>            :       -0.0051268316,    -0.0054091476,    -0.0056034233,    -0.005714261,</a>
<a name="535"><span class="lineNum">     535 </span>            :       -0.0057445862,    -0.0057025906,    -0.0055920109,    -0.0054194843,</a>
<a name="536"><span class="lineNum">     536 </span>            :       -0.0051914565,    -0.0049146507,    -0.0045959447,    -0.0042418269 },</a>
<a name="537"><span class="lineNum">     537 </span>            :     { -0.0016376863,    -0.0017651899,    -0.0018608454,    -0.0019252141,</a>
<a name="538"><span class="lineNum">     538 </span>            :       -0.0019593791,    -0.0019653172,    -0.0019450618,    -0.0018990048,</a>
<a name="539"><span class="lineNum">     539 </span>            :       -0.00183808,      -0.0017501717,    -0.0016481078,    -0.0015320742,</a>
<a name="540"><span class="lineNum">     540 </span>            :       -0.0014046903,    -0.0012685474,    -0.001125814,     -0.00097943726 },</a>
<a name="541"><span class="lineNum">     541 </span>            :     { -0.00055432378,   -0.00055472925,   -0.00054783461,   -0.00053276919,</a>
<a name="542"><span class="lineNum">     542 </span>            :       -0.00051135791,   -0.00048466062,   -0.00045358928,   -0.00042499689,</a>
<a name="543"><span class="lineNum">     543 </span>            :       -0.00036942671,   -0.0003392619,    -0.00030001783,   -0.00025986304,</a>
<a name="544"><span class="lineNum">     544 </span>            :       -0.0002197204,    -0.00018116167,   -0.00014691355,   -0.00011279432 },</a>
<a name="545"><span class="lineNum">     545 </span>            :     { -0.000064147389,  -0.00006174868,   -0.000054267788,  -0.000047133824,</a>
<a name="546"><span class="lineNum">     546 </span>            :       -0.000042927582,  -0.000039477309,  -0.000036340745,  -0.000029687517,</a>
<a name="547"><span class="lineNum">     547 </span>            :       -0.000049787737,  -0.000041577889,  -0.000033864744,  -0.000026534748,</a>
<a name="548"><span class="lineNum">     548 </span>            :       -0.000019841305,  -0.000014789486,  -0.000013131184,  -0.0000099198869 },</a>
<a name="549"><span class="lineNum">     549 </span>            :     { -0.0000062990207, -0.0000072701259, -0.000011984052,  -0.000017348082,</a>
<a name="550"><span class="lineNum">     550 </span>            :       -0.000019907106,  -0.000021348773,  -0.000021961965,  -0.000012203576,</a>
<a name="551"><span class="lineNum">     551 </span>            :       -0.000010840992,   4.6299544e-7,     5.2588763e-7,     2.7792686e-7,</a>
<a name="552"><span class="lineNum">     552 </span>            :       -2.3649704e-7,    -0.0000010897784, -9.171448e-7,     -5.22682e-7 }</a>
<a name="553"><span class="lineNum">     553 </span>            : };</a>
<a name="554"><span class="lineNum">     554 </span>            : </a>
<a name="555"><span class="lineNum">     555 </span>            : /* Second half of the 384-tap IPQF filtering coefficients. */</a>
<a name="556"><span class="lineNum">     556 </span>            : static const float ipqf_coeffs2[ATRAC3P_PQF_FIR_LEN][16] = {</a>
<a name="557"><span class="lineNum">     557 </span>            :     {  5.22682e-7,       9.171448e-7,      0.0000010897784,  2.3649704e-7,</a>
<a name="558"><span class="lineNum">     558 </span>            :       -2.7792686e-7,    -5.2588763e-7,    -4.6299544e-7,     0.000010840992,</a>
<a name="559"><span class="lineNum">     559 </span>            :       -0.000012203576,  -0.000021961965,  -0.000021348773,  -0.000019907106,</a>
<a name="560"><span class="lineNum">     560 </span>            :       -0.000017348082,  -0.000011984052,  -0.0000072701259, -0.0000062990207 },</a>
<a name="561"><span class="lineNum">     561 </span>            :     {  0.0000099198869,  0.000013131184,   0.000014789486,   0.000019841305,</a>
<a name="562"><span class="lineNum">     562 </span>            :        0.000026534748,   0.000033864744,   0.000041577889,   0.000049787737,</a>
<a name="563"><span class="lineNum">     563 </span>            :       -0.000029687517,  -0.000036340745,  -0.000039477309,  -0.000042927582,</a>
<a name="564"><span class="lineNum">     564 </span>            :       -0.000047133824,  -0.000054267788,  -0.00006174868,   -0.000064147389 },</a>
<a name="565"><span class="lineNum">     565 </span>            :     {  0.00011279432,    0.00014691355,    0.00018116167,    0.0002197204,</a>
<a name="566"><span class="lineNum">     566 </span>            :        0.00025986304,    0.00030001783,    0.0003392619,     0.00036942671,</a>
<a name="567"><span class="lineNum">     567 </span>            :       -0.00042499689,   -0.00045358928,   -0.00048466062,   -0.00051135791,</a>
<a name="568"><span class="lineNum">     568 </span>            :       -0.00053276919,   -0.00054783461,   -0.00055472925,   -0.00055432378 },</a>
<a name="569"><span class="lineNum">     569 </span>            :     {  0.00097943726,    0.001125814,      0.0012685474,     0.0014046903,</a>
<a name="570"><span class="lineNum">     570 </span>            :        0.0015320742,     0.0016481078,     0.0017501717,     0.00183808,</a>
<a name="571"><span class="lineNum">     571 </span>            :       -0.0018990048,    -0.0019450618,    -0.0019653172,    -0.0019593791,</a>
<a name="572"><span class="lineNum">     572 </span>            :       -0.0019252141,    -0.0018608454,    -0.0017651899,    -0.0016376863 },</a>
<a name="573"><span class="lineNum">     573 </span>            :     {  0.0042418269,     0.0045959447,     0.0049146507,     0.0051914565,</a>
<a name="574"><span class="lineNum">     574 </span>            :        0.0054194843,     0.0055920109,     0.0057025906,     0.0057445862,</a>
<a name="575"><span class="lineNum">     575 </span>            :       -0.005714261,     -0.0056034233,    -0.0054091476,    -0.0051268316,</a>
<a name="576"><span class="lineNum">     576 </span>            :       -0.0047529764,    -0.0042847847,    -0.0037203205,    -0.0030586775 },</a>
<a name="577"><span class="lineNum">     577 </span>            :     {  0.019670162,      0.021246184,      0.022781773,      0.024265358,</a>
<a name="578"><span class="lineNum">     578 </span>            :        0.025685543,      0.027031265,      0.028291954,      0.02945766,</a>
<a name="579"><span class="lineNum">     579 </span>            :       -0.030518902,     -0.031467363,     -0.032295227,     -0.032995768,</a>
<a name="580"><span class="lineNum">     580 </span>            :       -0.033563249,     -0.033992987,     -0.034281436,     -0.034426283 },</a>
<a name="581"><span class="lineNum">     581 </span>            :     { -0.018065533,     -0.016444042,     -0.014817309,     -0.013196872,</a>
<a name="582"><span class="lineNum">     582 </span>            :       -0.011593862,     -0.010018963,     -0.0084823566,    -0.0069935122,</a>
<a name="583"><span class="lineNum">     583 </span>            :        0.0055614738,     0.0041943151,     0.0028992873,     0.001682895,</a>
<a name="584"><span class="lineNum">     584 </span>            :        0.00055068987,   -0.00049266568,   -0.001443546,     -0.0022995141 },</a>
<a name="585"><span class="lineNum">     585 </span>            :     { -0.0038591374,    -0.0034549395,    -0.0030352892,    -0.0026067684,</a>
<a name="586"><span class="lineNum">     586 </span>            :       -0.0021754825,    -0.0017469483,    -0.001326357,     -0.00091862219,</a>
<a name="587"><span class="lineNum">     587 </span>            :        0.00052769453,    0.00015771533,   -0.00018855913,   -0.00050782406,</a>
<a name="588"><span class="lineNum">     588 </span>            :       -0.00079780724,   -0.0010566821,    -0.001283227,     -0.0014771431 },</a>
<a name="589"><span class="lineNum">     589 </span>            :     { -0.00083093712,   -0.00068422867,   -0.00053928449,   -0.00039945057,</a>
<a name="590"><span class="lineNum">     590 </span>            :       -0.00026649953,   -0.00014135583,   -0.000025081157,   0.000084307925,</a>
<a name="591"><span class="lineNum">     591 </span>            :       -0.00018248901,   -0.00026866337,   -0.00034301577,   -0.00040612387,</a>
<a name="592"><span class="lineNum">     592 </span>            :       -0.00045778,      -0.00049731287,   -0.00052537228,   -0.00054488552 },</a>
<a name="593"><span class="lineNum">     593 </span>            :     { -0.00008079566,   -0.000053397067,  -0.00002610587,   -0.0000016657353,</a>
<a name="594"><span class="lineNum">     594 </span>            :        0.000018532943,   0.000035615325,   0.000049888811,   0.000056296329,</a>
<a name="595"><span class="lineNum">     595 </span>            :       -0.000058270442,  -0.000062285151,  -0.000070208509,  -0.000074850752,</a>
<a name="596"><span class="lineNum">     596 </span>            :       -0.00007612785,   -0.000073081472,  -0.000068306952,  -0.000064464548 },</a>
<a name="597"><span class="lineNum">     597 </span>            :     { -0.000048585582,  -0.000046043948,  -0.000045337845,  -0.000041575615,</a>
<a name="598"><span class="lineNum">     598 </span>            :       -0.000036968919,  -0.000032302323,  -0.00002780562,   -0.000023530851,</a>
<a name="599"><span class="lineNum">     599 </span>            :        0.0000018111954, -5.7168614e-7,    -0.0000015432918, -0.0000026336629,</a>
<a name="600"><span class="lineNum">     600 </span>            :       -0.0000041712024, -0.0000079212787, -0.000010502935,  -0.0000091622824 },</a>
<a name="601"><span class="lineNum">     601 </span>            :     { -0.0000070302972, -0.0000063894258, -0.0000046192422, -0.0000032569742,</a>
<a name="602"><span class="lineNum">     602 </span>            :       -0.0000023108685, -0.0000014333754, -6.005389e-7,      0.000011838618,</a>
<a name="603"><span class="lineNum">     603 </span>            :        0.000010516783,   1.2660377e-8,     3.530856e-8,      3.226247e-8,</a>
<a name="604"><span class="lineNum">     604 </span>            :       -4.4400572e-8,    -4.2005411e-7,    -8.0604229e-7,    -5.8336207e-7 }</a>
<a name="605"><span class="lineNum">     605 </span>            : };</a>
<a name="606"><span class="lineNum">     606 </span>            : </a>
<a name="607"><span class="lineNum">     607 </span><span class="lineNoCov">          0 : void ff_atrac3p_ipqf(FFTContext *dct_ctx, Atrac3pIPQFChannelCtx *hist,</span></a>
<a name="608"><span class="lineNum">     608 </span>            :                      const float *in, float *out)</a>
<a name="609"><span class="lineNum">     609 </span>            : {</a>
<a name="610"><span class="lineNum">     610 </span><span class="lineNoCov">          0 :     int i, s, sb, t, pos_now, pos_next;</span></a>
<a name="611"><span class="lineNum">     611 </span><span class="lineNoCov">          0 :     LOCAL_ALIGNED(32, float, idct_in, [ATRAC3P_SUBBANDS]);</span></a>
<a name="612"><span class="lineNum">     612 </span><span class="lineNoCov">          0 :     LOCAL_ALIGNED(32, float, idct_out, [ATRAC3P_SUBBANDS]);</span></a>
<a name="613"><span class="lineNum">     613 </span>            : </a>
<a name="614"><span class="lineNum">     614 </span><span class="lineNoCov">          0 :     memset(out, 0, ATRAC3P_FRAME_SAMPLES * sizeof(*out));</span></a>
<a name="615"><span class="lineNum">     615 </span>            : </a>
<a name="616"><span class="lineNum">     616 </span><span class="lineNoCov">          0 :     for (s = 0; s &lt; ATRAC3P_SUBBAND_SAMPLES; s++) {</span></a>
<a name="617"><span class="lineNum">     617 </span>            :         /* pick up one sample from each subband */</a>
<a name="618"><span class="lineNum">     618 </span><span class="lineNoCov">          0 :         for (sb = 0; sb &lt; ATRAC3P_SUBBANDS; sb++)</span></a>
<a name="619"><span class="lineNum">     619 </span><span class="lineNoCov">          0 :             idct_in[sb] = in[sb * ATRAC3P_SUBBAND_SAMPLES + s];</span></a>
<a name="620"><span class="lineNum">     620 </span>            : </a>
<a name="621"><span class="lineNum">     621 </span>            :         /* Calculate the sine and cosine part of the PQF using IDCT-IV */</a>
<a name="622"><span class="lineNum">     622 </span><span class="lineNoCov">          0 :         dct_ctx-&gt;imdct_half(dct_ctx, idct_out, idct_in);</span></a>
<a name="623"><span class="lineNum">     623 </span>            : </a>
<a name="624"><span class="lineNum">     624 </span>            :         /* append the result to the history */</a>
<a name="625"><span class="lineNum">     625 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; 8; i++) {</span></a>
<a name="626"><span class="lineNum">     626 </span><span class="lineNoCov">          0 :             hist-&gt;buf1[hist-&gt;pos][i] = idct_out[i + 8];</span></a>
<a name="627"><span class="lineNum">     627 </span><span class="lineNoCov">          0 :             hist-&gt;buf2[hist-&gt;pos][i] = idct_out[7 - i];</span></a>
<a name="628"><span class="lineNum">     628 </span>            :         }</a>
<a name="629"><span class="lineNum">     629 </span>            : </a>
<a name="630"><span class="lineNum">     630 </span><span class="lineNoCov">          0 :         pos_now  = hist-&gt;pos;</span></a>
<a name="631"><span class="lineNum">     631 </span><span class="lineNoCov">          0 :         pos_next = mod23_lut[pos_now + 2]; // pos_next = (pos_now + 1) % 23;</span></a>
<a name="632"><span class="lineNum">     632 </span>            : </a>
<a name="633"><span class="lineNum">     633 </span><span class="lineNoCov">          0 :         for (t = 0; t &lt; ATRAC3P_PQF_FIR_LEN; t++) {</span></a>
<a name="634"><span class="lineNum">     634 </span><span class="lineNoCov">          0 :             for (i = 0; i &lt; 8; i++) {</span></a>
<a name="635"><span class="lineNum">     635 </span><span class="lineNoCov">          0 :                 out[s * 16 + i + 0] += hist-&gt;buf1[pos_now][i]  * ipqf_coeffs1[t][i] +</span></a>
<a name="636"><span class="lineNum">     636 </span><span class="lineNoCov">          0 :                                        hist-&gt;buf2[pos_next][i] * ipqf_coeffs2[t][i];</span></a>
<a name="637"><span class="lineNum">     637 </span><span class="lineNoCov">          0 :                 out[s * 16 + i + 8] += hist-&gt;buf1[pos_now][7 - i]  * ipqf_coeffs1[t][i + 8] +</span></a>
<a name="638"><span class="lineNum">     638 </span><span class="lineNoCov">          0 :                                        hist-&gt;buf2[pos_next][7 - i] * ipqf_coeffs2[t][i + 8];</span></a>
<a name="639"><span class="lineNum">     639 </span>            :             }</a>
<a name="640"><span class="lineNum">     640 </span>            : </a>
<a name="641"><span class="lineNum">     641 </span><span class="lineNoCov">          0 :             pos_now  = mod23_lut[pos_next + 2]; // pos_now  = (pos_now  + 2) % 23;</span></a>
<a name="642"><span class="lineNum">     642 </span><span class="lineNoCov">          0 :             pos_next = mod23_lut[pos_now + 2];  // pos_next = (pos_next + 2) % 23;</span></a>
<a name="643"><span class="lineNum">     643 </span>            :         }</a>
<a name="644"><span class="lineNum">     644 </span>            : </a>
<a name="645"><span class="lineNum">     645 </span><span class="lineNoCov">          0 :         hist-&gt;pos = mod23_lut[hist-&gt;pos]; // hist-&gt;pos = (hist-&gt;pos - 1) % 23;</span></a>
<a name="646"><span class="lineNum">     646 </span>            :     }</a>
<a name="647"><span class="lineNum">     647 </span><span class="lineNoCov">          0 : }</span></a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
